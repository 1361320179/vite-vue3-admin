var ie=Object.defineProperty,ue=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var N=(n,e,t)=>e in n?ie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,S=(n,e)=>{for(var t in e||(e={}))ce.call(e,t)&&N(n,t,e[t]);if(M)for(var t of M(e))pe.call(e,t)&&N(n,t,e[t]);return n},I=(n,e)=>ue(n,de(e));var f=(n,e,t)=>new Promise((l,r)=>{var c=b=>{try{p(t.next(b))}catch(O){r(O)}},h=b=>{try{p(t.throw(b))}catch(O){r(O)}},p=b=>b.done?l(b.value):Promise.resolve(b.value).then(c,h);p((t=t.apply(n,e)).next())});import{c as s,A as P,aP as me,aG as L,b3 as fe,aN as J,d as ee,k as E,b4 as he,N as C,O as be,U as w,au as T,a8 as y,b5 as v,b6 as _,r as ge,p as ye,Y as we,Z as U,a7 as d,$ as u,ay as q,b7 as z,ah as ve,a as _e,M as $,a9 as V,b8 as Oe,aR as xe,aQ as K,b9 as H}from"./index.bfc8a675.js";import{A as Pe}from"./index.fbe24a75.js";import{g as Se,u as Ie,c as $e,t as Ee,d as Ce,a as De}from"./index.9d0be4e7.js";import{u as ke}from"./dynamic-table.68b23df4.js";import{u as Fe}from"./useFormModal.f3651b8a.js";import{f as Ae,a as Be}from"./utils.1ab06744.js";import"./VerticalRightOutlined.82a58a5b.js";import"./schema-form.c7aa7552.js";import"./index.0a5789cb.js";var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},Me=je;function R(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),l.forEach(function(r){Ne(n,r,t[r])})}return n}function Ne(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var D=function(e,t){var l=R({},e,t.attrs);return s(P,R({},l,{icon:Me}),null)};D.displayName="DeleteOutlined";D.inheritAttrs=!1;var W=D,Le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},Te=Le;function X(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),l.forEach(function(r){Ue(n,r,t[r])})}return n}function Ue(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var k=function(e,t){var l=X({},e,t.attrs);return s(P,X({},l,{icon:Te}),null)};k.displayName="EditOutlined";k.inheritAttrs=!1;var qe=k,ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"},Ve=ze;function G(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),l.forEach(function(r){Ke(n,r,t[r])})}return n}function Ke(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var F=function(e,t){var l=G({},e,t.attrs);return s(P,G({},l,{icon:Ve}),null)};F.displayName="SwapOutlined";F.inheritAttrs=!1;var He=F,Re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"},We=Re;function Q(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),l.forEach(function(r){Xe(n,r,t[r])})}return n}function Xe(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var A=function(e,t){var l=Q({},e,t.attrs);return s(P,Q({},l,{icon:We}),null)};A.displayName="SyncOutlined";A.inheritAttrs=!1;var Ge=A;const Qe=[{field:"name",component:"Input",label:"\u90E8\u95E8\u540D\u79F0",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"\u4E0A\u7EA7\u90E8\u95E8",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"orderNum",component:"InputNumber",label:"\u6392\u5E8F\u53F7",defaultValue:255,componentProps:{style:{width:"100%"}}}],Ye=[{field:"departmentId",component:"TreeSelect",label:"\u6240\u5C5E\u90E8\u95E8",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"roles",component:"Select",label:"\u6240\u5C5E\u89D2\u8272",rules:[{required:!0,type:"array"}],componentProps:{mode:"multiple",request:()=>f(void 0,null,function*(){return(yield Se()).map(e=>({label:e.name,value:e.id}))})}},{field:"username",component:"Input",label:"\u7528\u6237\u540D",rules:[{required:!0}]},{field:"name",component:"Input",label:"\u59D3\u540D",colProps:{span:12},rules:[{required:!0}]},{field:"nickName",component:"Input",label:"\u5462\u79F0",colProps:{span:12}},{field:"email",component:"Input",label:"\u90AE\u7BB1",colProps:{span:12}},{field:"phone",component:"Input",label:"\u624B\u673A",colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"\u5907\u6CE8"},{field:"status",component:"RadioGroup",label:"\u72B6\u6001",defaultValue:1,componentProps:{options:[{label:"\u542F\u7528",value:1},{label:"\u7981\u7528",value:0}]}}],Ze=[{field:"password",component:"Input",label:"\u65B0\u5BC6\u7801",rules:[{required:!0,type:"string"}]}],Je=[{field:"departmentId",component:"TreeSelect",label:"\u8F6C\u79FB\u81F3",rules:[{required:!0,type:"number"}]}];function Y(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!fe(n)}const et=[{title:"\u5934\u50CF",width:80,dataIndex:"headImg",hideInSearch:!0,bodyCell:({record:n})=>s(me,{src:n.headImg},null)},{title:"\u59D3\u540D",width:120,dataIndex:"name",align:"center"},{title:"\u7528\u6237\u540D",width:120,align:"center",dataIndex:"username"},{title:"\u6240\u5728\u90E8\u95E8",dataIndex:"departmentName",hideInSearch:!0,align:"center",width:180},{title:"\u6240\u5C5E\u89D2\u8272",dataIndex:"roleNames",align:"center",hideInSearch:!0,width:220,customRender:({text:n})=>{let e;return s(J,null,Y(e=n.map(t=>s(L,{color:"success",key:t},Y(t)?t:{default:()=>[t]})))?e:{default:()=>[e]})}},{title:"\u5462\u79F0",width:120,align:"center",dataIndex:"nickName"},{title:"\u90AE\u7BB1",width:120,align:"center",dataIndex:"email"},{title:"\u624B\u673A",width:120,align:"center",dataIndex:"phone"},{title:"\u5907\u6CE8",width:120,align:"center",dataIndex:"remark"},{title:"\u72B6\u6001",dataIndex:"status",width:100,formItemProps:{component:"Select",componentProps:{options:[{label:"\u542F\u7528",value:1},{label:"\u7981\u7528",value:0}]}},bodyCell:({record:n})=>{const e=n.status===1;return s(L,{color:e?"success":"red"},{default:()=>[e?"\u542F\u7528":"\u7981\u7528"]})}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createdAt",width:120,formItemProps:{component:"DatePicker",componentProps:{class:"w-full"}}},{title:"\u4FEE\u6539\u65F6\u95F4",dataIndex:"updatedAt",width:120,formItemProps:{component:"DatePicker",componentProps:{class:"w-full"}}}];const tt={class:"split-wrapper"},nt={class:"left-content"},at=y(" \u53F3\u8FB9\u5185\u5BB9\u533A "),lt=w("i",null,null,-1),st=w("i",null,null,-1),rt=[lt,st],ot={class:"right-content"},it=y(" \u53F3\u8FB9\u5185\u5BB9\u533A "),ut=ee({__name:"index",setup(n){const e=E();let t,l;const r=he(function(p){e.value&&(e.value.style.width=`${l+p.clientX-t}px`)},20),c=()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",r),document.documentElement.removeEventListener("mouseup",c)},h=p=>{t=p.clientX,e.value&&(l=parseInt(window.getComputedStyle(e.value).width,10)),document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",r),document.documentElement.addEventListener("mouseup",c)};return(p,b)=>(C(),be("div",tt,[w("div",{ref_key:"scalable",ref:e,class:"scalable"},[w("div",nt,[T(p.$slots,"left-content",{},()=>[at])]),w("div",{ref:"separator",class:"separator",onMousedown:h},rt,544)],512),w("div",ot,[T(p.$slots,"right-content",{},()=>[it])])]))}});var dt=ut;function ct(n){return v({url:_.page,method:"post",data:n})}function pt(n){return v({url:_.add,method:"post",data:n},{successMsg:"\u521B\u5EFA\u7528\u6237\u6210\u529F"})}function mt(n){return v({url:_.info,method:"get",params:n})}function ft(n){return v({url:_.update,method:"post",data:n},{successMsg:"\u4FEE\u6539\u7528\u6237\u6210\u529F"})}function ht(n){return v({url:_.password,method:"post",data:n},{successMsg:"\u64CD\u4F5C\u6210\u529F"})}function Z(n){return v({url:_.delete,method:"post",data:n})}const bt={class:"flex justify-between"},gt=w("div",null,"\u7EC4\u7EC7\u67B6\u6784",-1),yt=y("\u65B0\u589E\u90E8\u95E8 "),wt=y("\u5237\u65B0 "),vt=y(" \u7F16\u8F91 "),_t=y(" \u5220\u9664 "),Ot=y("\u53D6\u6D88\u9009\u62E9"),xt=y(" \u65B0\u589E "),Pt=y(" \u8F6C\u79FB "),St=y(" \u5220\u9664 "),It={name:"SystemUser"};var Nt=ee(I(S({},It),{setup(n){const[e,t]=ke(),[l]=Fe(),r=E(!1),c=ge({expandedKeys:[],departmentIds:[],deptTree:[]}),h=E({selectedRowKeys:[],onChange:(a,o)=>{`${a}`,h.value.selectedRowKeys=a}}),p=ye(()=>h.value.selectedRowKeys.length),b=(...o)=>f(this,[...o],function*(a={}){var m;const[i]=yield l({modalProps:{title:`${a.id?"\u7F16\u8F91":"\u65B0\u589E"}\u90E8\u95E8`,width:700,onFinish:g=>f(this,null,function*(){g.id=a.id,yield(a.id?Ie:$e)(g),x()})},formProps:{labelWidth:100,schemas:Qe}});i==null||i.updateSchema([{field:"parentId",componentProps:{treeDefaultExpandedKeys:[-1].concat((a==null?void 0:a.keyPath)||[]),treeData:[{value:-1,title:"#",children:c.deptTree}]}}]),i==null||i.setFieldsValue(I(S({},a),{parentId:(m=a.parentId)!=null?m:-1}))}),O=()=>f(this,null,function*(){const[a]=yield l({modalProps:{title:"\u8F6C\u79FB\u90E8\u95E8",width:700,onFinish:o=>f(this,null,function*(){yield Ee({departmentId:o.departmentId,userIds:h.value.selectedRowKeys.map(i=>i)})})},formProps:{labelWidth:100,schemas:Je}});a==null||a.updateSchema([{field:"departmentId",componentProps:{treeData:c.deptTree}}])}),B=(...o)=>f(this,[...o],function*(a={}){var m;const[i]=yield l({modalProps:{title:`${a.id?"\u7F16\u8F91":"\u65B0\u589E"}\u7528\u6237`,width:700,onFinish:g=>f(this,null,function*(){g.id=a.id,yield(a.id?ft:pt)(g),t==null||t.reload()})},formProps:{labelWidth:100,schemas:Ye}});if(i==null||i.updateSchema([{field:"departmentId",componentProps:{treeDefaultExpandedKeys:((m=Ae(a==null?void 0:a.departmentId,c.deptTree))==null?void 0:m.keyPath)||[],treeData:c.deptTree}}]),i==null||i.setFieldsValue(a),a!=null&&a.id){const{roles:g}=yield mt({userId:a.id});i==null||i.setFieldsValue({roles:g})}}),te=a=>f(this,null,function*(){yield l({modalProps:{title:`\u4FEE\u6539\u5BC6\u7801(${a.username})`,width:700,onFinish:o=>f(this,null,function*(){yield ht({userId:a.id,password:o.password})})},formProps:{labelWidth:100,schemas:Ze}})}),ne=a=>{K.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u90E8\u95E8\u5417?",icon:s(H,null,null),centered:!0,onOk:()=>f(this,null,function*(){yield Ce({departmentId:a}),x()})})},x=()=>f(this,null,function*(){r.value=!0;const a=yield De().finally(()=>r.value=!1);c.deptTree=Be(a),c.expandedKeys=[...c.expandedKeys,...c.deptTree.map(o=>Number(o.key))]});x();const j=a=>f(this,null,function*(){Array.isArray(a)?K.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u6240\u9009\u7684\u7528\u6237\u5417?",icon:s(H,null,null),centered:!0,onOk:()=>f(this,null,function*(){yield Z({userIds:a}),x()})}):yield Z({userIds:[a]}).finally(t==null?void 0:t.reload)}),ae=a=>{var o;c.departmentIds=a,(o=t==null?void 0:t.reload)==null||o.call(t)},le=i=>f(this,[i],function*({page:a,limit:o}){const m=yield ct({page:a,limit:o,departmentIds:c.departmentIds.length?c.departmentIds:void 0});return h.value.selectedRowKeys=[],m}),se=[...et,{title:"\u64CD\u4F5C",width:230,dataIndex:"$action",align:"center",fixed:"right",actions:({record:a})=>[{label:"\u7F16\u8F91",auth:{perm:"sys.user.update",effect:"disable"},onClick:()=>B(a)},{label:"\u6539\u5BC6",auth:"sys.user.password",onClick:()=>te(a)},{label:"\u5220\u9664",auth:"sys.user.delete",popConfirm:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",onConfirm:()=>j(a.id)}}]}];return(a,o)=>{const i=we("a-button");return C(),U(u(dt),null,{"left-content":d(()=>[w("div",bt,[gt,s(u(J),null,{default:d(()=>[a.$auth("sys.dept.add")?(C(),U(u(q),{key:0,placement:"top"},{title:d(()=>[yt]),default:d(()=>[s(u(z),{onClick:o[0]||(o[0]=m=>b({}))})]),_:1})):ve("",!0),s(u(q),{placement:"top"},{title:d(()=>[wt]),default:d(()=>[s(u(Ge),{spin:r.value,onClick:x},null,8,["spin"])]),_:1})]),_:1})]),s(u(Oe),{expandedKeys:c.expandedKeys,"onUpdate:expandedKeys":o[1]||(o[1]=m=>c.expandedKeys=m),"auto-expand-parent":"","tree-data":c.deptTree,onSelect:ae},{title:d(({key:m,title:g,formData:re})=>[s(u(_e),{trigger:["contextmenu"]},{overlay:d(()=>[s(u($),null,{default:d(()=>[s(u($).Item,{key:"1",disabled:!a.$auth("sys.dept.update"),onClick:oe=>b(re)},{default:d(()=>[vt,s(u(qe))]),_:2},1032,["disabled","onClick"]),s(u($).Item,{key:"2",disabled:!a.$auth("sys.dept.delete"),onClick:oe=>ne(m)},{default:d(()=>[_t,s(u(W))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),default:d(()=>[w("span",null,V(g),1)]),_:2},1024)]),_:1},8,["expandedKeys","tree-data"])]),"right-content":d(()=>[s(u(e),{"header-title":"\u7528\u6237\u7BA1\u7406","show-index":"","title-tooltip":"\u8BF7\u4E0D\u8981\u968F\u610F\u5220\u9664\u7528\u6237\uFF0C\u907F\u514D\u5230\u5F71\u54CD\u5176\u4ED6\u7528\u6237\u7684\u4F7F\u7528\u3002","data-request":le,columns:se,scroll:{x:2e3},"row-selection":h.value},xe({toolbar:d(()=>[s(i,{type:"primary",disabled:!a.$auth("sys.user.add"),onClick:o[3]||(o[3]=m=>B({}))},{default:d(()=>[s(u(z)),xt]),_:1},8,["disabled"]),s(i,{type:"success",disabled:!u(p)||!a.$auth("sys.dept.transfer"),onClick:O},{default:d(()=>[s(u(He)),Pt]),_:1},8,["disabled"]),s(i,{type:"danger",disabled:!u(p)||!a.$auth("sys.user.delete"),onClick:o[4]||(o[4]=m=>j(h.value.selectedRowKeys))},{default:d(()=>[s(u(W)),St]),_:1},8,["disabled"])]),_:2},[u(p)?{name:"title",fn:d(()=>[s(u(Pe),{class:"w-full",type:"info","show-icon":""},{message:d(()=>[y(" \u5DF2\u9009 "+V(u(p))+" \u9879 ",1),s(i,{type:"link",onClick:o[2]||(o[2]=m=>h.value.selectedRowKeys=[])},{default:d(()=>[Ot]),_:1})]),_:1})])}:void 0]),1032,["row-selection"])]),_:1})}}}));export{Nt as default};
